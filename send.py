#!/usr/bin/env python3

import serial
import time
import sys
import platform

from local_keys import *

ser =  serial.Serial()

ser.port = '/dev/ttyUSB0'
ser.baudrate = 2400
ser.parity = serial.PARITY_EVEN

try:
    ser.open()
    sys.stdout.write('%s access ok.\n' % (ser.port))
except serial.SerialException:
    sys.stdout.write('%s access fail.\n' % (ser.port))
    sys.exit()


tx_frame =  [0xfe, 0xfe, 0x68]
tx_frame += [0x11, 0x11, 0x11, 0x11, 0x11, 0x11]
tx_frame += [0x68, 0x13, 0x00]
tx_frame += [0xdf, 0x16]

tx_frame =  [0xfe, 0xfe, 0x68]
tx_frame += [0x11, 0x11, 0x11, 0x11, 0x11, 0x11]
tx_frame += [0x68, 0x11, 0x04, 0x3b, 0x33, 0xb3, 0x35]
tx_frame += [0xa1, 0x16]

tx_frame =  [0xFE, 0xFE, 0xFE, 0xFE, 0x68]
tx_frame += [0x11, 0x11, 0x11, 0x11, 0x11, 0x11]
tx_frame += [0x69, 0x20, 0x1A, 0x00, 0x68]
tx_frame += [0x11, 0x11, 0x11, 0x11, 0x11, 0x11]
tx_frame += [0x68, 0x1C, 0x10, 0x35, 0x89, 0x67, 0x45, 0xB8]
tx_frame += [0x73, 0x39, 0xA3, 0x4D, 0x33, 0x8C, 0x8C, 0x56]
tx_frame += [0x53, 0x45, 0x4B, 0x15, 0x16] 

sys.stdout.write('TX: ')
for x in tx_frame:
    sys.stdout.write('%02x ' % (x))

sys.stdout.write('\n');

tx_bytes = bytearray(tx_frame)

ser.write(tx_bytes)

time.sleep(1)

rx_bytes = bytearray(ser.read(ser.inWaiting()))
rx_frame = [c for c in rx_bytes]

sys.stdout.write('RX: ')
for x in rx_frame:
    sys.stdout.write('%02x ' % (x))

sys.stdout.write('\n');
ser.close()
